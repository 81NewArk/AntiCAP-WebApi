(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{285:(e,t,a)=>{"use strict";a.d(t,{$:()=>c});var s=a(5155),r=a(2115),l=a(9708),i=a(2085),n=a(9434);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:a,variant:r,size:i,asChild:c=!1,...d}=e,m=c?l.DX:"button";return(0,s.jsx)(m,{className:(0,n.cn)(o({variant:r,size:i,className:a})),ref:t,...d})});c.displayName="Button"},2523:(e,t,a)=>{"use strict";a.d(t,{p:()=>i});var s=a(5155),r=a(2115),l=a(9434);let i=r.forwardRef((e,t)=>{let{className:a,type:r,...i}=e;return(0,s.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...i})});i.displayName="Input"},6695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>i,aR:()=>n,wL:()=>m});var s=a(5155),r=a(2115),l=a(9434);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});i.displayName="Card";let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...r})});n.displayName="CardHeader";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});o.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...r})});d.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...r})});m.displayName="CardFooter"},7135:(e,t,a)=>{Promise.resolve().then(a.bind(a,9061))},7313:(e,t,a)=>{"use strict";a.d(t,{Xi:()=>c,av:()=>d,j7:()=>o,tU:()=>n});var s=a(5155),r=a(2115),l=a(8880),i=a(9434);let n=l.bL,o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.B8,{ref:t,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});o.displayName=l.B8.displayName;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.l9,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});c.displayName=l.l9.displayName;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.UC,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});d.displayName=l.UC.displayName},7481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>h});var s=a(2115);let r=0,l=new Map,i=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},n=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],c={toasts:[]};function d(e){c=n(c,e),o.forEach(e=>{e(c)})}function m(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function h(){let[e,t]=s.useState(c);return s.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:m,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},8931:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(5155),r=a(2115),l=a(7431);let i=()=>{let e=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!e.current)return;let t=e.current,a=new l.Z58,s=new l.ubm(75,t.clientWidth/t.clientHeight,.1,1e3);s.position.z=3;let r=new l.JeP({antialias:!0,alpha:!0});r.setSize(t.clientWidth,t.clientHeight),r.setPixelRatio(window.devicePixelRatio),t.appendChild(r.domElement);let i=new l.LoY,n=new Float32Array(15e3);for(let e=0;e<15e3;e++)n[e]=(Math.random()-.5)*10;i.setAttribute("position",new l.THS(n,3));let o=new l.BH$({size:.015,color:0xbe29ec,transparent:!0,blending:l.EZo}),c=new l.ONl(i,o);a.add(c);let d=new l.BH$({size:.01,color:2745580,transparent:!0,blending:l.EZo}),m=new l.ONl(i.clone(),d);a.add(m);let h=new l.I9Y,u=e=>{h.x=e.clientX/window.innerWidth*2-1,h.y=-(2*(e.clientY/window.innerHeight))+1};window.addEventListener("mousemove",u);let x=new l.zD7,p=()=>{let e=x.getElapsedTime();c.rotation.y=.05*e+.2*h.x,c.rotation.x=.05*e+.2*h.y,m.rotation.y=-(.03*e)+.2*h.x,m.rotation.x=-(.03*e)+.2*h.y,requestAnimationFrame(p),r.render(a,s)};p();let f=()=>{t&&(s.aspect=t.clientWidth/t.clientHeight,s.updateProjectionMatrix(),r.setSize(t.clientWidth,t.clientHeight))};return window.addEventListener("resize",f),()=>{if(window.removeEventListener("resize",f),window.removeEventListener("mousemove",u),t&&r.domElement)try{t.removeChild(r.domElement)}catch(e){}r.dispose(),i.dispose(),o.dispose(),d.dispose(),m.geometry.dispose()}},[]),(0,s.jsx)("div",{ref:e,className:"absolute top-0 left-0 w-full h-full -z-10"})}},8979:(e,t,a)=>{"use strict";a.d(t,{J:()=>d});var s=a(5155),r=a(2115),l=a(3655),i=r.forwardRef((e,t)=>(0,s.jsx)(l.sG.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null==(a=e.onMouseDown)||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var n=a(2085),o=a(9434);let c=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i,{ref:t,className:(0,o.cn)(c(),a),...r})});d.displayName=i.displayName},9061:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>U});var s=a(5155),r=a(2115),l=a(5695),i=a(9576),n=a(285),o=a(6695),c=a(7313),d=a(2523),m=a(8979),h=a(9434);let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,h.cn)("w-full caption-bottom text-sm",a),...r})})});u.displayName="Table";let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("thead",{ref:t,className:(0,h.cn)("[&_tr]:border-b",a),...r})});x.displayName="TableHeader";let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,h.cn)("[&_tr:last-child]:border-0",a),...r})});p.displayName="TableBody",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,h.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...r})}).displayName="TableFooter";let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tr",{ref:t,className:(0,h.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...r})});f.displayName="TableRow";let g=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("th",{ref:t,className:(0,h.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...r})});g.displayName="TableHead";let j=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("td",{ref:t,className:(0,h.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...r})});j.displayName="TableCell",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("caption",{ref:t,className:(0,h.cn)("mt-4 text-sm text-muted-foreground",a),...r})}).displayName="TableCaption";var v=a(3651),y=a(5318);let b=v.bL;v.l9;let N=v.ZL;v.bm;let w=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(v.hJ,{ref:t,className:(0,h.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});w.displayName=v.hJ.displayName;let k=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(N,{children:[(0,s.jsx)(w,{}),(0,s.jsxs)(v.UC,{ref:t,className:(0,h.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l,children:[r,(0,s.jsxs)(v.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(y.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});k.displayName=v.UC.displayName;let S=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,h.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};S.displayName="DialogHeader";let A=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,h.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};A.displayName="DialogFooter";let C=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(v.hE,{ref:t,className:(0,h.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});C.displayName=v.hE.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(v.VY,{ref:t,className:(0,h.cn)("text-sm text-muted-foreground",a),...r})}).displayName=v.VY.displayName;var T=a(7481),E=a(8062),z=a(8186),R=a(157);let I=(0,R.A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);var M=a(286);let O=(0,R.A)("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),_=(0,R.A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),D=(0,R.A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),F=(0,R.A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),B=(0,R.A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),$=(0,R.A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var P=a(5599),L=a(6874),H=a.n(L),J=a(8931);function U(){var e;let{user:t,token:a,logout:h,isLoggedIn:v}=(0,i.A)(),y=(0,l.useRouter)(),{toast:N}=(0,T.dj)(),[w,R]=(0,r.useState)([]),[L,U]=(0,r.useState)(!1),[Z,V]=(0,r.useState)(""),[W,X]=(0,r.useState)([]),[q,Y]=(0,r.useState)(!1),[G,K]=(0,r.useState)("1000"),[Q,ee]=(0,r.useState)([]),[et,ea]=(0,r.useState)(!1),[es,er]=(0,r.useState)(null),[el,ei]=(0,r.useState)(""),[en,eo]=(0,r.useState)(""),[ec,ed]=(0,r.useState)(!1),[em,eh]=(0,r.useState)(null),[eu,ex]=(0,r.useState)(""),[ep,ef]=(0,r.useState)(""),[eg,ej]=(0,r.useState)(!1),[ev,ey]=(0,r.useState)(!1);(0,r.useEffect)(()=>{var e;if(!v)return void y.push("/login");t&&(null==(e=t.role)?void 0:e.toUpperCase())!=="ADMIN"&&(N({title:"权限不足",description:"您没有管理员权限",variant:"destructive"}),y.push("/myhome"))},[v,t,y,N]),(0,r.useEffect)(()=>{var e;v&&(null==t||null==(e=t.role)?void 0:e.toUpperCase())==="ADMIN"&&a&&(eb(),eN(),ew())},[v,t,a]);let eb=async()=>{U(!0);try{let e=await fetch("/api/admin/users",{headers:{Authorization:"Bearer ".concat(a)}});if(401===e.status){N({title:"会话已过期",description:"请重新登录",variant:"destructive"}),h();return}if(e.ok){let t=await e.json();R(t)}else throw Error("Failed to fetch users")}catch(e){console.error(e),N({title:"获取用户失败",description:"无法加载用户列表",variant:"destructive"})}finally{U(!1)}},eN=async()=>{Y(!0);try{let e=await fetch("/api/admin/regcodes",{headers:{Authorization:"Bearer ".concat(a)}});if(e.ok){let t=await e.json();X(t)}else throw Error("Failed to fetch registration codes")}catch(e){console.error(e),N({title:"获取注册码失败",description:"无法加载注册码列表",variant:"destructive"})}finally{Y(!1)}},ew=async()=>{ea(!0);try{let e=await fetch("/api/admin/costs",{headers:{Authorization:"Bearer ".concat(a)}});if(e.ok){let t=await e.json();ee(t)}else throw Error("Failed to fetch costs")}catch(e){console.error(e),N({title:"获取扣点配置失败",description:"无法加载接口扣点配置",variant:"destructive"})}finally{ea(!1)}},ek=async()=>{try{let e=await fetch("/api/admin/generate_code",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({points:parseInt(G)||1e3})});if(e.ok){let t=await e.json();V(t.registration_code),ey(!0),N({title:"生成成功",description:"新的注册码已生成"}),eN()}else throw Error("Failed to generate code")}catch(e){N({title:"生成失败",description:"无法生成注册码",variant:"destructive"})}},eS=async e=>{try{let t=await fetch("/api/admin/regcodes/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}});if(t.ok)N({title:"删除成功",description:"注册码已删除"}),eN();else{let e=await t.json();throw Error(e.detail||"Failed to delete registration code")}}catch(e){N({title:"删除失败",description:e.message,variant:"destructive"})}},eA=async()=>{if(em)try{let e={};if(eu&&(e.password=eu),ep&&(e.balance=parseInt(ep)),(await fetch("/api/admin/users/".concat(em.username),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(e)})).ok)N({title:"更新成功",description:"用户 ".concat(em.username," 已更新")}),ej(!1),eh(null),ex(""),ef(""),eb();else throw Error("Failed to update user")}catch(e){N({title:"更新失败",description:"无法更新用户信息",variant:"destructive"})}},eC=async()=>{if(es)try{if((await fetch("/api/admin/costs",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({path:es.path,cost:parseInt(el),description:en})})).ok)N({title:"更新成功",description:"接口 ".concat(es.path," 扣点已更新")}),ed(!1),er(null),ew();else throw Error("Failed to update cost")}catch(e){N({title:"更新失败",description:"无法更新扣点配置",variant:"destructive"})}},eT=e=>{er(e),ei(e.cost.toString()),eo(e.description||""),ed(!0)},eE=e=>{eh(e),ef(e.balance.toString()),ex(""),ej(!0)},ez=e=>{navigator.clipboard.writeText(e),N({title:"已复制",description:"内容已复制到剪贴板"})};return t&&(null==(e=t.role)?void 0:e.toUpperCase())==="ADMIN"?(0,s.jsxs)("div",{className:"relative w-full min-h-screen bg-background text-white overflow-x-hidden",children:[(0,s.jsx)(J.A,{}),(0,s.jsxs)("div",{className:"relative z-10 flex flex-col min-h-screen",children:[(0,s.jsxs)("header",{className:"w-full p-4 sm:p-6 flex justify-between items-center shrink-0 sticky top-0 z-50 bg-background/80 backdrop-blur-lg border-b border-primary/10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(E.A,{className:"w-8 h-8 text-primary"}),(0,s.jsx)("h1",{className:"text-2xl font-bold font-headline text-white mr-4",children:"AntiCAP Admin"}),(0,s.jsx)(H(),{href:"/myhome",children:(0,s.jsxs)(n.$,{variant:"ghost",size:"sm",className:"gap-2 text-gray-400 hover:text-white",children:[(0,s.jsx)(z.A,{className:"w-4 h-4"}),"我的主页"]})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-400",children:["Welcome, ",null==t?void 0:t.username]}),(0,s.jsx)(n.$,{variant:"ghost",size:"icon",onClick:h,title:"Logout",children:(0,s.jsx)(I,{className:"w-5 h-5"})})]})]}),(0,s.jsx)("main",{className:"flex-grow p-4 sm:p-8 max-w-7xl mx-auto w-full",children:(0,s.jsxs)(c.tU,{defaultValue:"users",className:"w-full space-y-6",children:[(0,s.jsxs)(c.j7,{className:"grid w-full grid-cols-3 max-w-[600px]",children:[(0,s.jsxs)(c.Xi,{value:"users",className:"flex items-center gap-2",children:[(0,s.jsx)(M.A,{className:"w-4 h-4"}),"用户管理"]}),(0,s.jsxs)(c.Xi,{value:"codes",className:"flex items-center gap-2",children:[(0,s.jsx)(O,{className:"w-4 h-4"}),"注册码管理"]}),(0,s.jsxs)(c.Xi,{value:"costs",className:"flex items-center gap-2",children:[(0,s.jsx)(_,{className:"w-4 h-4"}),"扣点设置"]})]}),(0,s.jsx)(c.av,{value:"users",children:(0,s.jsxs)(o.Zp,{className:"bg-black/30 backdrop-blur-xl border-primary/20",children:[(0,s.jsxs)(o.aR,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(o.ZB,{children:"用户列表"}),(0,s.jsx)(o.BT,{children:"管理所有注册用户"})]}),(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:eb,disabled:L,children:[(0,s.jsx)(D,{className:"w-4 h-4 mr-2 ".concat(L?"animate-spin":"")}),"刷新"]})]}),(0,s.jsx)(o.Wu,{children:(0,s.jsx)("div",{className:"rounded-md border border-primary/10 overflow-hidden",children:(0,s.jsxs)(u,{children:[(0,s.jsx)(x,{className:"bg-primary/5",children:(0,s.jsxs)(f,{children:[(0,s.jsx)(g,{className:"text-white",children:"ID"}),(0,s.jsx)(g,{className:"text-white",children:"用户名"}),(0,s.jsx)(g,{className:"text-white",children:"角色"}),(0,s.jsx)(g,{className:"text-white",children:"余额"}),(0,s.jsx)(g,{className:"text-right text-white",children:"操作"})]})}),(0,s.jsx)(p,{children:w.map(e=>(0,s.jsxs)(f,{className:"hover:bg-primary/5",children:[(0,s.jsx)(j,{children:e.id}),(0,s.jsx)(j,{className:"font-medium",children:e.username}),(0,s.jsx)(j,{children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("ADMIN"===e.role?"bg-red-500/20 text-red-300":"bg-blue-500/20 text-blue-300"),children:e.role})}),(0,s.jsx)(j,{children:e.balance}),(0,s.jsx)(j,{className:"text-right",children:(0,s.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>eE(e),children:"编辑"})})]},e.id))})]})})})]})}),(0,s.jsx)(c.av,{value:"codes",className:"space-y-6",children:(0,s.jsxs)(o.Zp,{className:"bg-black/30 backdrop-blur-xl border-primary/20",children:[(0,s.jsxs)(o.aR,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(o.ZB,{children:"注册码管理"}),(0,s.jsx)(o.BT,{children:"生成、查看和管理注册码"})]}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mr-2",children:[(0,s.jsx)(m.J,{htmlFor:"points",className:"whitespace-nowrap",children:"点数:"}),(0,s.jsx)(d.p,{id:"points",type:"number",value:G,onChange:e=>K(e.target.value),className:"w-24 bg-black/20 border-primary/20 h-9"})]}),(0,s.jsxs)(n.$,{onClick:ek,children:[(0,s.jsx)(F,{className:"w-4 h-4 mr-2"}),"生成新注册码"]}),(0,s.jsx)(n.$,{variant:"outline",size:"icon",onClick:eN,disabled:q,title:"刷新列表",children:(0,s.jsx)(D,{className:"w-4 h-4 ".concat(q?"animate-spin":"")})})]})]}),(0,s.jsx)(o.Wu,{children:(0,s.jsx)("div",{className:"rounded-md border border-primary/10 overflow-hidden",children:(0,s.jsxs)(u,{children:[(0,s.jsx)(x,{className:"bg-primary/5",children:(0,s.jsxs)(f,{children:[(0,s.jsx)(g,{className:"text-white",children:"ID"}),(0,s.jsx)(g,{className:"text-white",children:"注册码"}),(0,s.jsx)(g,{className:"text-white",children:"点数"}),(0,s.jsx)(g,{className:"text-white",children:"状态"}),(0,s.jsx)(g,{className:"text-right text-white",children:"操作"})]})}),(0,s.jsxs)(p,{children:[W.map(e=>(0,s.jsxs)(f,{className:"hover:bg-primary/5",children:[(0,s.jsx)(j,{children:e.id}),(0,s.jsx)(j,{className:"font-mono",children:e.code}),(0,s.jsx)(j,{children:e.points}),(0,s.jsx)(j,{children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.is_used?"bg-red-500/20 text-red-300":"bg-green-500/20 text-green-300"),children:e.is_used?"已使用":"未使用"})}),(0,s.jsx)(j,{className:"text-right",children:(0,s.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>eS(e.id),disabled:e.is_used,className:"text-red-400 hover:text-red-300 hover:bg-red-900/20",children:[(0,s.jsx)(B,{className:"w-4 h-4 mr-1"}),"删除"]})})]},e.id)),0===W.length&&!q&&(0,s.jsx)(f,{children:(0,s.jsx)(j,{colSpan:5,className:"text-center text-gray-500 py-8",children:"暂无注册码"})})]})]})})})]})}),(0,s.jsx)(c.av,{value:"costs",children:(0,s.jsxs)(o.Zp,{className:"bg-black/30 backdrop-blur-xl border-primary/20",children:[(0,s.jsxs)(o.aR,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(o.ZB,{children:"接口扣点设置"}),(0,s.jsx)(o.BT,{children:"管理各接口的调用扣点数"})]}),(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:ew,disabled:et,children:[(0,s.jsx)(D,{className:"w-4 h-4 mr-2 ".concat(et?"animate-spin":"")}),"刷新"]})]}),(0,s.jsx)(o.Wu,{children:(0,s.jsx)("div",{className:"rounded-md border border-primary/10 overflow-hidden",children:(0,s.jsxs)(u,{children:[(0,s.jsx)(x,{className:"bg-primary/5",children:(0,s.jsxs)(f,{children:[(0,s.jsx)(g,{className:"text-white",children:"接口路径"}),(0,s.jsx)(g,{className:"text-white",children:"描述"}),(0,s.jsx)(g,{className:"text-white",children:"扣点"}),(0,s.jsx)(g,{className:"text-right text-white",children:"操作"})]})}),(0,s.jsx)(p,{children:Q.map(e=>(0,s.jsxs)(f,{className:"hover:bg-primary/5",children:[(0,s.jsx)(j,{className:"font-mono text-sm",children:e.path}),(0,s.jsx)(j,{children:e.description}),(0,s.jsx)(j,{children:e.cost}),(0,s.jsx)(j,{className:"text-right",children:(0,s.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>eT(e),children:[(0,s.jsx)($,{className:"w-4 h-4 mr-1"}),"编辑"]})})]},e.id))})]})})})]})})]})}),(0,s.jsx)(b,{open:eg,onOpenChange:ej,children:(0,s.jsxs)(k,{className:"bg-background/95 backdrop-blur-xl border-primary/20 text-white",children:[(0,s.jsx)(S,{children:(0,s.jsxs)(C,{children:["编辑用户: ",null==em?void 0:em.username]})}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m.J,{htmlFor:"balance",children:"余额"}),(0,s.jsx)(d.p,{id:"balance",type:"number",value:ep,onChange:e=>ef(e.target.value),className:"bg-black/20 border-primary/20"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m.J,{htmlFor:"password",children:"新密码 (留空不修改)"}),(0,s.jsx)(d.p,{id:"password",type:"password",value:eu,onChange:e=>ex(e.target.value),className:"bg-black/20 border-primary/20",placeholder:"******"})]})]}),(0,s.jsxs)(A,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>ej(!1),children:"取消"}),(0,s.jsx)(n.$,{onClick:eA,children:"保存修改"})]})]})}),(0,s.jsx)(b,{open:ec,onOpenChange:ed,children:(0,s.jsxs)(k,{className:"bg-background/95 backdrop-blur-xl border-primary/20 text-white",children:[(0,s.jsx)(S,{children:(0,s.jsxs)(C,{children:["编辑扣点: ",null==es?void 0:es.path]})}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m.J,{htmlFor:"cost",children:"扣点数"}),(0,s.jsx)(d.p,{id:"cost",type:"number",value:el,onChange:e=>ei(e.target.value),className:"bg-black/20 border-primary/20"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m.J,{htmlFor:"description",children:"描述"}),(0,s.jsx)(d.p,{id:"description",value:en,onChange:e=>eo(e.target.value),className:"bg-black/20 border-primary/20"})]})]}),(0,s.jsxs)(A,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>ed(!1),children:"取消"}),(0,s.jsx)(n.$,{onClick:eC,children:"保存修改"})]})]})}),(0,s.jsx)(b,{open:ev,onOpenChange:ey,children:(0,s.jsxs)(k,{className:"bg-background/95 backdrop-blur-xl border-primary/20 text-white sm:max-w-md",children:[(0,s.jsx)(S,{children:(0,s.jsx)(C,{className:"text-center",children:"注册码生成成功"})}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-6 py-6",children:[(0,s.jsxs)("div",{className:"text-center space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"注册码"}),(0,s.jsxs)("div",{className:"w-full p-3 bg-black/40 rounded-lg border border-primary/30 flex items-center justify-between gap-3 max-w-[350px]",children:[(0,s.jsx)("code",{className:"text-lg font-mono text-primary truncate flex-1 text-center select-all",children:Z}),(0,s.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>ez(Z),className:"shrink-0 h-8 w-8",children:(0,s.jsx)(P.A,{className:"w-4 h-4"})})]})]}),(0,s.jsxs)("div",{className:"text-center space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"包含点数"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:G})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 text-center max-w-[80%]",children:"请复制并保存此注册码，它将用于新用户注册。"})]}),(0,s.jsx)(A,{className:"sm:justify-center",children:(0,s.jsx)(n.$,{onClick:()=>ey(!1),className:"w-full sm:w-auto min-w-[120px]",children:"关闭"})})]})})]})]}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen text-white",children:"Loading or Access Denied..."})}},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l});var s=a(2596),r=a(9688);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},9576:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,AuthProvider:()=>n});var s=a(5155),r=a(2115),l=a(5695);let i=(0,r.createContext)(void 0);function n(e){let{children:t}=e,[a,n]=(0,r.useState)(null),[o,c]=(0,r.useState)(null),[d,m]=(0,r.useState)(!0),h=(0,l.useRouter)(),u=(0,r.useCallback)(async()=>{m(!0);try{let e=localStorage.getItem("authToken");if(e){let t=await fetch("/api/tokens/verification",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let a=await t.json();n(e),c(a),localStorage.setItem("user",JSON.stringify(a))}else localStorage.removeItem("authToken"),localStorage.removeItem("user"),n(null),c(null)}}catch(e){console.error("Failed to verify token",e),localStorage.removeItem("authToken"),localStorage.removeItem("user"),n(null),c(null)}finally{m(!1)}},[]);(0,r.useEffect)(()=>{u()},[u]);let x=!!a&&!!o;return(0,s.jsx)(i.Provider,{value:{token:a,user:o,isLoggedIn:x,login:(e,t)=>{n(e),c(t);try{localStorage.setItem("authToken",e),localStorage.setItem("user",JSON.stringify(t)),"ADMIN"===t.role?h.push("/admin"):h.push("/myhome")}catch(e){console.error("Failed to access localStorage",e)}},logout:()=>{n(null),c(null);try{localStorage.removeItem("authToken"),localStorage.removeItem("user"),h.push("/login")}catch(e){console.error("Failed to access localStorage",e)}},isLoading:d,checkAuth:u,updateBalance:e=>{if(o){let t={...o,balance:e};c(t);try{localStorage.setItem("user",JSON.stringify(t))}catch(e){console.error("Failed to access localStorage",e)}}}},children:t})}function o(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[367,272,574,743,441,684,977],()=>t(7135)),_N_E=e.O()}]);