(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{285:(e,t,a)=>{"use strict";a.d(t,{$:()=>d});var s=a(5155),r=a(2115),l=a(9708),i=a(2085),n=a(9434);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:a,variant:r,size:i,asChild:d=!1,...c}=e,u=d?l.DX:"button";return(0,s.jsx)(u,{className:(0,n.cn)(o({variant:r,size:i,className:a})),ref:t,...c})});d.displayName="Button"},2523:(e,t,a)=>{"use strict";a.d(t,{p:()=>i});var s=a(5155),r=a(2115),l=a(9434);let i=r.forwardRef((e,t)=>{let{className:a,type:r,...i}=e;return(0,s.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...i})});i.displayName="Input"},6695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>i,aR:()=>n,wL:()=>u});var s=a(5155),r=a(2115),l=a(9434);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});i.displayName="Card";let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...r})});n.displayName="CardHeader";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});o.displayName="CardTitle";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})});d.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...r})});c.displayName="CardContent";let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...r})});u.displayName="CardFooter"},7135:(e,t,a)=>{Promise.resolve().then(a.bind(a,7980))},7313:(e,t,a)=>{"use strict";a.d(t,{Xi:()=>d,av:()=>c,j7:()=>o,tU:()=>n});var s=a(5155),r=a(2115),l=a(8880),i=a(9434);let n=l.bL,o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.B8,{ref:t,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});o.displayName=l.B8.displayName;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.l9,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});d.displayName=l.l9.displayName;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.UC,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});c.displayName=l.UC.displayName},7481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>m});var s=a(2115);let r=0,l=new Map,i=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},n=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],d={toasts:[]};function c(e){d=n(d,e),o.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function m(){let[e,t]=s.useState(d);return s.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},7980:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>L});var s=a(5155),r=a(2115),l=a(5695),i=a(9576),n=a(285),o=a(6695),d=a(7313),c=a(2523),u=a(8979),m=a(9434);let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,m.cn)("w-full caption-bottom text-sm",a),...r})})});f.displayName="Table";let h=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("thead",{ref:t,className:(0,m.cn)("[&_tr]:border-b",a),...r})});h.displayName="TableHeader";let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,m.cn)("[&_tr:last-child]:border-0",a),...r})});x.displayName="TableBody",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,m.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...r})}).displayName="TableFooter";let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tr",{ref:t,className:(0,m.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...r})});p.displayName="TableRow";let g=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("th",{ref:t,className:(0,m.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...r})});g.displayName="TableHead";let b=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("td",{ref:t,className:(0,m.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...r})});b.displayName="TableCell",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("caption",{ref:t,className:(0,m.cn)("mt-4 text-sm text-muted-foreground",a),...r})}).displayName="TableCaption";var v=a(3651),y=a(5318);let j=v.bL;v.l9;let N=v.ZL;v.bm;let w=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(v.hJ,{ref:t,className:(0,m.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});w.displayName=v.hJ.displayName;let k=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(N,{children:[(0,s.jsx)(w,{}),(0,s.jsxs)(v.UC,{ref:t,className:(0,m.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l,children:[r,(0,s.jsxs)(v.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(y.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});k.displayName=v.UC.displayName;let S=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,m.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};S.displayName="DialogHeader";let A=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,m.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};A.displayName="DialogFooter";let T=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(v.hE,{ref:t,className:(0,m.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});T.displayName=v.hE.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(v.VY,{ref:t,className:(0,m.cn)("text-sm text-muted-foreground",a),...r})}).displayName=v.VY.displayName;var C=a(7481),E=a(8062),R=a(157);let I=(0,R.A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);var z=a(286);let _=(0,R.A)("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),D=(0,R.A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),M=(0,R.A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),O=(0,R.A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var B=a(5599),F=a(8931);function L(){var e;let{user:t,token:a,logout:m,isLoggedIn:v}=(0,i.A)(),y=(0,l.useRouter)(),{toast:N}=(0,C.dj)(),[w,R]=(0,r.useState)([]),[L,P]=(0,r.useState)(!1),[H,$]=(0,r.useState)(""),[U,J]=(0,r.useState)([]),[Z,V]=(0,r.useState)(!1),[W,X]=(0,r.useState)(null),[Y,q]=(0,r.useState)(""),[G,K]=(0,r.useState)(""),[Q,ee]=(0,r.useState)(!1),[et,ea]=(0,r.useState)(!1);(0,r.useEffect)(()=>{var e;if(!v)return void y.push("/login");t&&(null==(e=t.role)?void 0:e.toUpperCase())!=="ADMIN"&&(N({title:"权限不足",description:"您没有管理员权限",variant:"destructive"}),y.push("/myhome"))},[v,t,y,N]);let es=async()=>{P(!0);try{let e=await fetch("/api/admin/users",{headers:{Authorization:"Bearer ".concat(a)}});if(401===e.status){N({title:"会话已过期",description:"请重新登录",variant:"destructive"}),m();return}if(e.ok){let t=await e.json();R(t)}else throw Error("Failed to fetch users")}catch(e){console.error(e),N({title:"获取用户失败",description:"无法加载用户列表",variant:"destructive"})}finally{P(!1)}},er=async()=>{V(!0);try{let e=await fetch("/api/admin/regcodes",{headers:{Authorization:"Bearer ".concat(a)}});if(e.ok){let t=await e.json();J(t)}else throw Error("Failed to fetch registration codes")}catch(e){console.error(e),N({title:"获取注册码失败",description:"无法加载注册码列表",variant:"destructive"})}finally{V(!1)}},el=async()=>{try{let e=await fetch("/api/admin/generate_code",{method:"POST",headers:{Authorization:"Bearer ".concat(a)}});if(e.ok){let t=await e.json();$(t.registration_code),ea(!0),N({title:"生成成功",description:"新的注册码已生成"}),er()}else throw Error("Failed to generate code")}catch(e){N({title:"生成失败",description:"无法生成注册码",variant:"destructive"})}},ei=async e=>{try{let t=await fetch("/api/admin/regcodes/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}});if(t.ok)N({title:"删除成功",description:"注册码已删除"}),er();else{let e=await t.json();throw Error(e.detail||"Failed to delete registration code")}}catch(e){N({title:"删除失败",description:e.message,variant:"destructive"})}},en=async()=>{if(W)try{let e={};if(Y&&(e.password=Y),G&&(e.balance=parseInt(G)),(await fetch("/api/admin/users/".concat(W.username),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(e)})).ok)N({title:"更新成功",description:"用户 ".concat(W.username," 已更新")}),ee(!1),X(null),q(""),K(""),es();else throw Error("Failed to update user")}catch(e){N({title:"更新失败",description:"无法更新用户信息",variant:"destructive"})}},eo=e=>{X(e),K(e.balance.toString()),q(""),ee(!0)},ed=e=>{navigator.clipboard.writeText(e),N({title:"已复制",description:"内容已复制到剪贴板"})};return((0,r.useEffect)(()=>{var e;(null==t||null==(e=t.role)?void 0:e.toUpperCase())==="ADMIN"&&a&&(es(),er())},[t,a]),t&&(null==(e=t.role)?void 0:e.toUpperCase())==="ADMIN")?(0,s.jsxs)("div",{className:"relative w-full min-h-screen bg-background text-white overflow-x-hidden",children:[(0,s.jsx)(F.A,{}),(0,s.jsxs)("div",{className:"relative z-10 flex flex-col min-h-screen",children:[(0,s.jsxs)("header",{className:"w-full p-4 sm:p-6 flex justify-between items-center shrink-0 sticky top-0 z-50 bg-background/80 backdrop-blur-lg border-b border-primary/10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(E.A,{className:"w-8 h-8 text-primary"}),(0,s.jsx)("h1",{className:"text-2xl font-bold font-headline text-white",children:"AntiCAP Admin"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-400",children:["Welcome, ",t.username]}),(0,s.jsx)(n.$,{variant:"ghost",size:"icon",onClick:m,title:"Logout",children:(0,s.jsx)(I,{className:"w-5 h-5"})})]})]}),(0,s.jsx)("main",{className:"flex-grow p-4 sm:p-8 max-w-7xl mx-auto w-full",children:(0,s.jsxs)(d.tU,{defaultValue:"users",className:"w-full space-y-6",children:[(0,s.jsxs)(d.j7,{className:"grid w-full grid-cols-2 max-w-[400px]",children:[(0,s.jsxs)(d.Xi,{value:"users",className:"flex items-center gap-2",children:[(0,s.jsx)(z.A,{className:"w-4 h-4"}),"用户管理"]}),(0,s.jsxs)(d.Xi,{value:"codes",className:"flex items-center gap-2",children:[(0,s.jsx)(_,{className:"w-4 h-4"}),"注册码管理"]})]}),(0,s.jsx)(d.av,{value:"users",children:(0,s.jsxs)(o.Zp,{className:"bg-black/30 backdrop-blur-xl border-primary/20",children:[(0,s.jsxs)(o.aR,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(o.ZB,{children:"用户列表"}),(0,s.jsx)(o.BT,{children:"管理所有注册用户"})]}),(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:es,disabled:L,children:[(0,s.jsx)(D,{className:"w-4 h-4 mr-2 ".concat(L?"animate-spin":"")}),"刷新"]})]}),(0,s.jsx)(o.Wu,{children:(0,s.jsx)("div",{className:"rounded-md border border-primary/10 overflow-hidden",children:(0,s.jsxs)(f,{children:[(0,s.jsx)(h,{className:"bg-primary/5",children:(0,s.jsxs)(p,{children:[(0,s.jsx)(g,{className:"text-white",children:"ID"}),(0,s.jsx)(g,{className:"text-white",children:"用户名"}),(0,s.jsx)(g,{className:"text-white",children:"角色"}),(0,s.jsx)(g,{className:"text-white",children:"余额"}),(0,s.jsx)(g,{className:"text-right text-white",children:"操作"})]})}),(0,s.jsx)(x,{children:w.map(e=>(0,s.jsxs)(p,{className:"hover:bg-primary/5",children:[(0,s.jsx)(b,{children:e.id}),(0,s.jsx)(b,{className:"font-medium",children:e.username}),(0,s.jsx)(b,{children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("ADMIN"===e.role?"bg-red-500/20 text-red-300":"bg-blue-500/20 text-blue-300"),children:e.role})}),(0,s.jsx)(b,{children:e.balance}),(0,s.jsx)(b,{className:"text-right",children:(0,s.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>eo(e),children:"编辑"})})]},e.id))})]})})})]})}),(0,s.jsx)(d.av,{value:"codes",className:"space-y-6",children:(0,s.jsx)(d.av,{value:"codes",className:"space-y-6",children:(0,s.jsxs)(o.Zp,{className:"bg-black/30 backdrop-blur-xl border-primary/20",children:[(0,s.jsxs)(o.aR,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(o.ZB,{children:"注册码管理"}),(0,s.jsx)(o.BT,{children:"生成、查看和管理注册码"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(n.$,{onClick:el,children:[(0,s.jsx)(M,{className:"w-4 h-4 mr-2"}),"生成新注册码"]}),(0,s.jsx)(n.$,{variant:"outline",size:"icon",onClick:er,disabled:Z,title:"刷新列表",children:(0,s.jsx)(D,{className:"w-4 h-4 ".concat(Z?"animate-spin":"")})})]})]}),(0,s.jsx)(o.Wu,{children:(0,s.jsx)("div",{className:"rounded-md border border-primary/10 overflow-hidden",children:(0,s.jsxs)(f,{children:[(0,s.jsx)(h,{className:"bg-primary/5",children:(0,s.jsxs)(p,{children:[(0,s.jsx)(g,{className:"text-white",children:"ID"}),(0,s.jsx)(g,{className:"text-white",children:"注册码"}),(0,s.jsx)(g,{className:"text-white",children:"状态"}),(0,s.jsx)(g,{className:"text-right text-white",children:"操作"})]})}),(0,s.jsxs)(x,{children:[U.map(e=>(0,s.jsxs)(p,{className:"hover:bg-primary/5",children:[(0,s.jsx)(b,{children:e.id}),(0,s.jsx)(b,{className:"font-mono",children:e.code}),(0,s.jsx)(b,{children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.is_used?"bg-red-500/20 text-red-300":"bg-green-500/20 text-green-300"),children:e.is_used?"已使用":"未使用"})}),(0,s.jsx)(b,{className:"text-right",children:(0,s.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>ei(e.id),disabled:e.is_used,className:"text-red-400 hover:text-red-300 hover:bg-red-900/20",children:[(0,s.jsx)(O,{className:"w-4 h-4 mr-1"}),"删除"]})})]},e.id)),0===U.length&&!Z&&(0,s.jsx)(p,{children:(0,s.jsx)(b,{colSpan:4,className:"text-center text-gray-500 py-8",children:"暂无注册码"})})]})]})})})]})})})]})}),(0,s.jsx)(j,{open:Q,onOpenChange:ee,children:(0,s.jsxs)(k,{className:"bg-background/95 backdrop-blur-xl border-primary/20 text-white",children:[(0,s.jsx)(S,{children:(0,s.jsxs)(T,{children:["编辑用户: ",null==W?void 0:W.username]})}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u.J,{htmlFor:"balance",children:"余额"}),(0,s.jsx)(c.p,{id:"balance",type:"number",value:G,onChange:e=>K(e.target.value),className:"bg-black/20 border-primary/20"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u.J,{htmlFor:"password",children:"新密码 (留空不修改)"}),(0,s.jsx)(c.p,{id:"password",type:"password",value:Y,onChange:e=>q(e.target.value),className:"bg-black/20 border-primary/20",placeholder:"******"})]})]}),(0,s.jsxs)(A,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>ee(!1),children:"取消"}),(0,s.jsx)(n.$,{onClick:en,children:"保存修改"})]})]})}),(0,s.jsx)(j,{open:et,onOpenChange:ea,children:(0,s.jsxs)(k,{className:"bg-background/95 backdrop-blur-xl border-primary/20 text-white sm:max-w-md",children:[(0,s.jsx)(S,{children:(0,s.jsx)(T,{className:"text-center",children:"注册码生成成功"})}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-6 py-6",children:[(0,s.jsxs)("div",{className:"w-full p-4 bg-black/40 rounded-lg border border-primary/30 flex items-center justify-between gap-3",children:[(0,s.jsx)("code",{className:"text-xl font-mono text-primary truncate flex-1 text-center",children:H}),(0,s.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>ed(H),className:"shrink-0",children:(0,s.jsx)(B.A,{className:"w-5 h-5"})})]}),(0,s.jsx)("p",{className:"text-sm text-gray-400 text-center",children:"请复制并保存此注册码，它将用于新用户注册。"})]}),(0,s.jsx)(A,{className:"sm:justify-center",children:(0,s.jsx)(n.$,{onClick:()=>ea(!1),className:"w-full sm:w-auto min-w-[120px]",children:"关闭"})})]})})]})]}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen text-white",children:"Loading or Access Denied..."})}},8931:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(5155),r=a(2115),l=a(7431);let i=()=>{let e=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!e.current)return;let t=e.current,a=new l.Z58,s=new l.ubm(75,t.clientWidth/t.clientHeight,.1,1e3);s.position.z=3;let r=new l.JeP({antialias:!0,alpha:!0});r.setSize(t.clientWidth,t.clientHeight),r.setPixelRatio(window.devicePixelRatio),t.appendChild(r.domElement);let i=new l.LoY,n=new Float32Array(15e3);for(let e=0;e<15e3;e++)n[e]=(Math.random()-.5)*10;i.setAttribute("position",new l.THS(n,3));let o=new l.BH$({size:.015,color:0xbe29ec,transparent:!0,blending:l.EZo}),d=new l.ONl(i,o);a.add(d);let c=new l.BH$({size:.01,color:2745580,transparent:!0,blending:l.EZo}),u=new l.ONl(i.clone(),c);a.add(u);let m=new l.I9Y,f=e=>{m.x=e.clientX/window.innerWidth*2-1,m.y=-(2*(e.clientY/window.innerHeight))+1};window.addEventListener("mousemove",f);let h=new l.zD7,x=()=>{let e=h.getElapsedTime();d.rotation.y=.05*e+.2*m.x,d.rotation.x=.05*e+.2*m.y,u.rotation.y=-(.03*e)+.2*m.x,u.rotation.x=-(.03*e)+.2*m.y,requestAnimationFrame(x),r.render(a,s)};x();let p=()=>{t&&(s.aspect=t.clientWidth/t.clientHeight,s.updateProjectionMatrix(),r.setSize(t.clientWidth,t.clientHeight))};return window.addEventListener("resize",p),()=>{if(window.removeEventListener("resize",p),window.removeEventListener("mousemove",f),t&&r.domElement)try{t.removeChild(r.domElement)}catch(e){}r.dispose(),i.dispose(),o.dispose(),c.dispose(),u.geometry.dispose()}},[]),(0,s.jsx)("div",{ref:e,className:"absolute top-0 left-0 w-full h-full -z-10"})}},8979:(e,t,a)=>{"use strict";a.d(t,{J:()=>c});var s=a(5155),r=a(2115),l=a(3655),i=r.forwardRef((e,t)=>(0,s.jsx)(l.sG.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null==(a=e.onMouseDown)||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var n=a(2085),o=a(9434);let d=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i,{ref:t,className:(0,o.cn)(d(),a),...r})});c.displayName=i.displayName},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l});var s=a(2596),r=a(9688);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},9576:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,AuthProvider:()=>n});var s=a(5155),r=a(2115),l=a(5695);let i=(0,r.createContext)(void 0);function n(e){let{children:t}=e,[a,n]=(0,r.useState)(null),[o,d]=(0,r.useState)(null),[c,u]=(0,r.useState)(!0),m=(0,l.useRouter)(),f=(0,r.useCallback)(async()=>{u(!0);try{let e=localStorage.getItem("authToken");if(e){let t=await fetch("/api/tokens/verification",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let a=await t.json();n(e),d(a),localStorage.setItem("user",JSON.stringify(a))}else localStorage.removeItem("authToken"),localStorage.removeItem("user"),n(null),d(null)}}catch(e){console.error("Failed to verify token",e),localStorage.removeItem("authToken"),localStorage.removeItem("user"),n(null),d(null)}finally{u(!1)}},[]);(0,r.useEffect)(()=>{f()},[f]);let h=!!a&&!!o;return(0,s.jsx)(i.Provider,{value:{token:a,user:o,isLoggedIn:h,login:(e,t)=>{n(e),d(t);try{localStorage.setItem("authToken",e),localStorage.setItem("user",JSON.stringify(t)),"ADMIN"===t.role?m.push("/admin"):m.push("/myhome")}catch(e){console.error("Failed to access localStorage",e)}},logout:()=>{n(null),d(null);try{localStorage.removeItem("authToken"),localStorage.removeItem("user"),m.push("/login")}catch(e){console.error("Failed to access localStorage",e)}},isLoading:c,checkAuth:f,updateBalance:e=>{if(o){let t={...o,balance:e};d(t);try{localStorage.setItem("user",JSON.stringify(t))}catch(e){console.error("Failed to access localStorage",e)}}}},children:t})}function o(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[367,272,848,743,441,684,977],()=>t(7135)),_N_E=e.O()}]);