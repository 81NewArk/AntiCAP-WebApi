(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[113],{5695:(e,t,r)=>{"use strict";var o=r(8999);r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}})},6127:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var o=r(5155),l=r(2115),a=r(9576),s=r(5695);function u(e){let{children:t}=e,{isLoggedIn:r,isLoading:u}=(0,a.A)(),n=(0,s.useRouter)();return((0,l.useEffect)(()=>{u||r||n.push("/login")},[r,u,n]),u||!r)?(0,o.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,o.jsx)("div",{className:"h-16 w-16 animate-spin rounded-full border-4 border-solid border-primary border-t-transparent"})}):(0,o.jsx)(o.Fragment,{children:t})}},7918:(e,t,r)=>{Promise.resolve().then(r.bind(r,6127))},9576:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,AuthProvider:()=>u});var o=r(5155),l=r(2115),a=r(5695);let s=(0,l.createContext)(void 0);function u(e){let{children:t}=e,[r,u]=(0,l.useState)(null),[n,c]=(0,l.useState)(null),[i,h]=(0,l.useState)(!0),d=(0,a.useRouter)(),m=(0,l.useCallback)(async()=>{h(!0);try{let e=localStorage.getItem("authToken");if(e){let t=await fetch("/api/tokens/verification",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let r=await t.json();u(e),c(r),localStorage.setItem("user",JSON.stringify(r))}else localStorage.removeItem("authToken"),localStorage.removeItem("user"),u(null),c(null)}}catch(e){console.error("Failed to verify token",e),localStorage.removeItem("authToken"),localStorage.removeItem("user"),u(null),c(null)}finally{h(!1)}},[]);(0,l.useEffect)(()=>{m()},[m]);let f=!!r&&!!n;return(0,o.jsx)(s.Provider,{value:{token:r,user:n,isLoggedIn:f,login:(e,t)=>{u(e),c(t);try{localStorage.setItem("authToken",e),localStorage.setItem("user",JSON.stringify(t)),"ADMIN"===t.role?d.push("/admin"):d.push("/myhome")}catch(e){console.error("Failed to access localStorage",e)}},logout:()=>{u(null),c(null);try{localStorage.removeItem("authToken"),localStorage.removeItem("user"),d.push("/login")}catch(e){console.error("Failed to access localStorage",e)}},isLoading:i,checkAuth:m,updateBalance:e=>{if(n){let t={...n,balance:e};c(t);try{localStorage.setItem("user",JSON.stringify(t))}catch(e){console.error("Failed to access localStorage",e)}}}},children:t})}function n(){let e=(0,l.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,977],()=>t(7918)),_N_E=e.O()}]);